<!DOCTYPE html>
<html lang="en" class="scroll-smooth dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Massachusetts Education Dashboard | DataConnect Robotics</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <link rel="icon" href="img/logo.png">
  <style>
    body {
      background-color: #f1f5f9; /* slate-100 */
    }
    .dark body {
      background-color: #0f172a !important; /* slate-900 */
    }
    .d3-tooltip {
      position: absolute;
      pointer-events: none;
      background: #1e293b;
      color: #fff;
      padding: 8px 14px;
      border-radius: 10px;
      font-size: 1rem;
      box-shadow: 0 4px 24px #0002;
      opacity: 0.97;
      z-index: 20;
      transition: opacity 0.2s;
      white-space: pre-line;
    }
  </style>
</head>
<body class="font-sans text-gray-900 dark:text-white min-h-screen flex flex-col">

  <!-- HEADER -->
  <header class="bg-white dark:bg-slate-900 shadow sticky top-0 z-20">
    <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
      <a href="/" class="flex items-center gap-3">
        <img src="img/logo.png" alt="Logo" class="h-12 rounded-lg shadow">
        <span class="text-2xl font-bold tracking-tight text-blue-700 dark:text-blue-400">DataConnect Robotics</span>
      </a>
      <nav class="hidden md:flex space-x-6 text-lg font-medium">
        <a href="/index.html" class="hover:text-blue-600 dark:hover:text-blue-400 transition">Home</a>
        <a href="/#about" class="hover:text-blue-600 dark:hover:text-blue-400 transition">About</a>
        <a href="/#contact" class="hover:text-blue-600 dark:hover:text-blue-400 transition">Contact</a>
        <a href="/classes.html" class="hover:text-blue-600 dark:hover:text-blue-400 transition">Classes</a>
      </nav>
      <div class="flex items-center gap-2">
        <button class="md:hidden text-2xl focus:outline-none" onclick="toggleMenu()">
          <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
        <button id="toggle-dark" class="ml-2 rounded-full border border-slate-200 dark:border-slate-700 p-2 hover:bg-blue-100 dark:hover:bg-blue-800 transition">
          <svg id="light-icon" class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="5" />
            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
          </svg>
          <svg id="dark-icon" class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M21 12.79A9 9 0 1111.21 3a7 7 0 0010 9.79z" />
          </svg>
        </button>
      </div>
    </div>
    <div id="mobile-menu" class="md:hidden hidden px-4 pb-4 bg-white dark:bg-slate-900">
      <a href="/index.html" class="block py-2 text-lg hover:text-blue-500 dark:hover:text-blue-400">Home</a>
      <a href="/#about" class="block py-2 text-lg hover:text-blue-500 dark:hover:text-blue-400">About</a>
      <a href="/#contact" class="block py-2 text-lg hover:text-blue-500 dark:hover:text-blue-400">Contact</a>
      <a href="/classes.html" class="block py-2 text-lg hover:text-blue-500 dark:hover:text-blue-400">Classes</a>
    </div>
  </header>

  <!-- HERO/BANNER -->
  <section class="relative flex flex-col items-center justify-center text-center py-20 px-6 bg-gradient-to-br from-blue-200 to-indigo-100 dark:from-blue-900 dark:to-indigo-900">
    <h1 class="relative z-10 text-4xl md:text-6xl font-bold mb-4 text-blue-900 dark:text-blue-200 drop-shadow">Massachusetts Education Dashboard</h1>
    <p class="relative z-10 text-xl md:text-2xl max-w-2xl text-blue-800 dark:text-blue-300">Explore graduation rates, teacher salaries, and moreâ€”interactive by school district.</p>
  </section>

  <!-- MAIN DASHBOARD -->
  <main class="flex-1 w-full max-w-6xl mx-auto py-12 px-4">
    <div class="bg-white dark:bg-slate-800 rounded-3xl shadow-xl p-6 md:p-10">
      <!-- Dashboard Controls -->
      <div class="flex flex-col md:flex-row items-center gap-6 mb-8">
        <label for="yearSlider" class="text-base font-semibold text-gray-700 dark:text-gray-200">Select Year</label>
        <input type="range" id="yearSlider" min="2013" max="2023" step="1" value="2021" class="w-60 accent-blue-500">
        <span id="selectedYear" class="text-base font-bold text-blue-700 dark:text-blue-300 ml-3">2021</span>
      </div>
      <!-- D3 Map -->
      <div id="map" class="w-full h-[600px] rounded-xl bg-slate-100 dark:bg-slate-900 shadow-inner overflow-auto relative"></div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="text-center py-8 text-base text-slate-600 dark:text-slate-400 bg-transparent">
    &copy; 2025 DataConnect Robotics. All rights reserved.
  </footer>

  <!-- SCRIPTS: Dark/Light Toggle -->
  <script>
    function toggleMenu() {
      const menu = document.getElementById('mobile-menu');
      menu.classList.toggle('hidden');
    }
    // Dark/light mode toggle
    if (localStorage.theme === 'light') {
      document.documentElement.classList.remove('dark');
    } else if (localStorage.theme === 'dark') {
      document.documentElement.classList.add('dark');
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.documentElement.classList.add('dark');
    }
    document.getElementById('toggle-dark').onclick = function () {
      const html = document.documentElement;
      if (html.classList.contains('dark')) {
        html.classList.remove('dark');
        localStorage.theme = 'light';
      } else {
        html.classList.add('dark');
        localStorage.theme = 'dark';
      }
    }
  </script>
  <!-- D3 DASHBOARD SCRIPT (SIMPLE EXAMPLE, UPDATE AS NEEDED) -->
  <script>
    // Example D3 map rendering with graduation rates
    const width = 900, height = 600;
    const svg = d3.select("#map")
      .append("svg")
      .attr("viewBox", `0 0 ${width} ${height}`)
      .attr("width", "100%")
      .attr("height", height)
      .style("background", "none");

    // ToolTip
    const tooltip = d3.select("body").append("div")
      .attr("class", "d3-tooltip")
      .style("opacity", 0);

    // Color scale for graduation rates
    const color = d3.scaleQuantize()
      .domain([60, 100]) // Adjust domain based on your data
      .range(d3.schemeBlues[7]);

    // Load and render the map + data
    let mapData, gradRates;
    function renderMap(selectedYear = 2021) {
      if (!mapData || !gradRates) return;
      // Build lookup by district code for selected year
      const gradByCode = {};
      gradRates.forEach(d => {
        const code = d["District Code"].toString().padStart(8, "0");
        if (+d["Year"] === +selectedYear) {
          let rate = d["% Graduated"];
          if (typeof rate === "string") rate = rate.replace("%", "").trim();
          rate = parseFloat(rate);
          if (!isNaN(rate)) gradByCode[code] = rate;
        }
      });
      // Clear previous map
      svg.selectAll("*").remove();
      // Render districts
      const projection = d3.geoMercator().fitSize([width, height], mapData);
      const path = d3.geoPath().projection(projection);

      svg.selectAll("path")
        .data(mapData.features)
        .join("path")
        .attr("d", path)
        .attr("fill", d => {
          const rate = gradByCode[d.properties.ORG8CODE];
          return rate ? color(rate) : "#e2e8f0";
        })
        .attr("stroke", "#333")
        .attr("stroke-width", 0.5)
        .on("mousemove", (event, d) => {
          const rate = gradByCode[d.properties.ORG8CODE];
          tooltip
            .style("opacity", 0.97)
            .html(`<strong>${d.properties.DISTRICT}</strong><br>Graduation Rate: ${rate ? rate + "%" : "N/A"}`)
            .style("left", (event.pageX + 20) + "px")
            .style("top", (event.pageY - 24) + "px");
        })
        .on("mouseleave", () => {
          tooltip.style("opacity", 0);
        });
    }

    // Load data and initialize
    Promise.all([
      d3.json("/data/SchoolDistricts_poly.geojson"),
      d3.csv("/data/Cleaned_grad_rates.csv")
    ]).then(([districts, gradRatesData]) => {
      mapData = districts;
      gradRates = gradRatesData;
      renderMap(+document.getElementById("yearSlider").value);
    });

    // Update map on slider change
    document.getElementById("yearSlider").addEventListener("input", function() {
      document.getElementById("selectedYear").textContent = this.value;
      renderMap(+this.value);
    });
  </script>
</body>
</html>
